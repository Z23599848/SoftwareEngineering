<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Create a calendar with a datepicker and store/retrieve a date and time data | Roehampton</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="Create a calendar with a datepicker and store/retrieve a date and time data" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Hosts module content for computing at Roehampton." />
<meta property="og:description" content="Hosts module content for computing at Roehampton." />
<link rel="canonical" href="https://roehampton.github.io/module-content/msc-software-development-2/week-10/lab/calendar-input.html" />
<meta property="og:url" content="https://roehampton.github.io/module-content/msc-software-development-2/week-10/lab/calendar-input.html" />
<meta property="og:site_name" content="Roehampton" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Create a calendar with a datepicker and store/retrieve a date and time data" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"Hosts module content for computing at Roehampton.","headline":"Create a calendar with a datepicker and store/retrieve a date and time data","url":"https://roehampton.github.io/module-content/msc-software-development-2/week-10/lab/calendar-input.html"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="stylesheet" href="/module-content/assets/css/style.css?v=ea56b5ca3cc64b80129c924758c62c92b98b36d5">
    <!-- start custom head snippets, customize with your own _includes/head-custom.html file -->

<!-- Setup Google Analytics -->



<!-- You can set your favicon here -->
<!-- link rel="shortcut icon" type="image/x-icon" href="/module-content/favicon.ico" -->

<!-- end custom head snippets -->

  </head>
  <body>
    <div class="container-lg px-3 my-5 markdown-body">
      

      <h1 id="create-a-calendar-with-a-datepicker-and-storeretrieve-a-date-and-time-data">Create a calendar with a datepicker and store/retrieve a date and time data</h1>

<h3 id="0-get-some-libraries">0. Get some libraries</h3>

<p>Date storage and formatting can be a tricky business with a lot of options.  Library code will help you. On the server side we will use a node.js library called luxon.  In a later stage we will use the jQuery libraries to build the user interface.</p>

<p>Install luxon</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm install luxon
</code></pre></div></div>

<p>Include luxon in your app.js file. Add this near the top near where you import other libraries:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// Add the luxon date formatting library
const { DateTime } = require("luxon");
</code></pre></div></div>

<p>Refresh your containers</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker-compose up <span class="nt">--build</span>
</code></pre></div></div>

<h3 id="1-create-a-table-in-your-database-using-the-mysql-datetime-type">1. Create a table in your database using the mysql datetime type</h3>

<p>(This is just an example - you can add a datetime column anywhere in your database on tables where it makes sense for you)</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="nv">`test_database`</span><span class="p">.</span><span class="nv">`dates`</span> <span class="p">(</span> <span class="nv">`date_id`</span> <span class="nb">INT</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span> <span class="p">,</span> <span class="nv">`date`</span> <span class="nb">DATETIME</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="p">,</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="nv">`date_id`</span><span class="p">));</span>
</code></pre></div></div>

<h3 id="2-pull-jquery-libraries-into-your-code-and-add-a-datepicker-function">2. Pull jQuery libraries into your code and add a datepicker function</h3>

<p>In this case, The libraries and function are added to a brand new template (calendar.pug).  However a better place for the libraries and function may be in the head section in layout.pug</p>

<p>Create a file in the views directory called calendar.pug and add the following.  This will display a datepicker and submit button, and will also print a list of all the dates in your dates table of the database (this is just so you can see how to output dates)</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">extends</span> <span class="nx">layout</span>
<span class="nx">block</span> <span class="nx">content</span>
    <span class="c1">// - jQuery plus the datepicker function are probably better placed in the layout template but they will work here</span>
    <span class="nx">script</span><span class="p">(</span><span class="nx">src</span><span class="o">=</span><span class="dl">'</span><span class="s1">https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js</span><span class="dl">'</span><span class="p">)</span>
    <span class="nx">script</span><span class="p">(</span><span class="nx">src</span><span class="o">=</span><span class="dl">'</span><span class="s1">https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js</span><span class="dl">'</span><span class="p">)</span>
    <span class="nx">link</span><span class="p">(</span><span class="nx">rel</span><span class="o">=</span><span class="dl">"</span><span class="s2">stylesheet</span><span class="dl">"</span> <span class="nx">href</span><span class="o">=</span><span class="dl">"</span><span class="s2">//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css</span><span class="dl">"</span><span class="p">)</span>
    <span class="nx">script</span><span class="p">.</span>
        <span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
            <span class="nx">$</span><span class="p">(</span><span class="dl">"</span><span class="s2">#datepicker</span><span class="dl">"</span><span class="p">).</span><span class="nx">datepicker</span><span class="p">({</span>
                <span class="na">dateFormat</span><span class="p">:</span> <span class="dl">"</span><span class="s2">yy-mm-dd</span><span class="dl">"</span>
            <span class="p">});</span>
        <span class="p">});</span>
    <span class="c1">// - Date picker form including submit</span>
    <span class="nx">form</span><span class="p">(</span><span class="nx">action</span><span class="o">=</span><span class="dl">'</span><span class="s1">/set-date</span><span class="dl">'</span><span class="p">,</span> <span class="nx">method</span><span class="o">=</span><span class="dl">'</span><span class="s1">POST</span><span class="dl">'</span><span class="p">)</span>
        <span class="nx">input</span><span class="p">(</span><span class="nx">type</span><span class="o">=</span><span class="dl">'</span><span class="s1">text</span><span class="dl">'</span> <span class="nx">id</span><span class="o">=</span><span class="dl">'</span><span class="s1">datepicker</span><span class="dl">'</span> <span class="nx">name</span><span class="o">=</span><span class="dl">'</span><span class="s1">date</span><span class="dl">'</span><span class="p">)</span>
        <span class="nx">input</span><span class="p">(</span><span class="nx">type</span><span class="o">=</span><span class="dl">'</span><span class="s1">submit</span><span class="dl">'</span> <span class="nx">value</span><span class="o">=</span><span class="dl">'</span><span class="s1">Submit</span><span class="dl">'</span><span class="p">)</span>
    <span class="nx">ul</span>
    <span class="o">-</span> <span class="c1">// Now we loop through the dates and display them</span>
    <span class="k">for</span> <span class="nx">date</span> <span class="k">in</span> <span class="nx">dates</span>
        <span class="nx">li</span> <span class="err">#</span><span class="p">{</span><span class="nx">date</span><span class="p">}</span>
</code></pre></div></div>

<h3 id="3-create-a-route-in-appjs-to-call-the-calendar-template">3. Create a route in app.js to call the calendar template</h3>

<p>This code will call the template and also provides code to populate the list of dates, just so you can see how to retrieve and format dates</p>

<p>In app.js add this function:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Create route for the calendar</span>
<span class="c1">// Here we have a page which demonstrates how to both input dates and display dates</span>
<span class="nx">app</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">/calendar</span><span class="dl">"</span><span class="p">,</span> <span class="k">async</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Get all the dates from the db to display</span>
    <span class="c1">// NB Move this to a model that is appropriate to your project</span>
    <span class="nx">sql</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">SELECT * from dates</span><span class="dl">"</span><span class="p">;</span>
    <span class="c1">// We could format dates either in the template or in the backend</span>
    <span class="nx">dates</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="nx">results</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">sql</span><span class="p">);</span>
    <span class="c1">// Loop through the results from the database</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">row</span> <span class="k">of</span> <span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// For some reason the dates are fomatted as jsDates. I think thats the Mysql2 library at work!</span>
        <span class="nx">dt</span> <span class="o">=</span> <span class="nx">DateTime</span><span class="p">.</span><span class="nx">fromJSDate</span><span class="p">(</span><span class="nx">row</span><span class="p">[</span><span class="dl">'</span><span class="s1">date</span><span class="dl">'</span><span class="p">]);</span>
        <span class="c1">// Format the date and push it to the row ready for the template</span>
        <span class="c1">// NB Formatting could also be done in the template</span>
        <span class="c1">// NB date formats are usually set up to work throughout your app, you would not usually set this in every row.</span>
        <span class="c1">// you could put this in your model.</span>
        <span class="nx">dates</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">dt</span><span class="p">.</span><span class="nx">toLocaleString</span><span class="p">(</span><span class="nx">DateTime</span><span class="p">.</span><span class="nx">DATE_HUGE</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="c1">// Render the calendar template, injecting the dates array as a variable.</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="dl">'</span><span class="s1">calendar</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span><span class="na">dates</span><span class="p">:</span> <span class="nx">dates</span><span class="p">});</span>
<span class="p">});</span>
</code></pre></div></div>

<h3 id="4-create-another-route-in-appjs-which-will-capture-the-input-and-add-it-to-the-database">4. Create another route in app.js which will capture the input and add it to the database</h3>

<p>In app.js, add this function</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Capture the date input and save to the db</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="dl">'</span><span class="s1">/set-date</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">params</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">date</span><span class="p">;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">params</span><span class="p">);</span>
    <span class="c1">//construct a date object from the submitted value - use a library</span>
    <span class="kd">var</span> <span class="nx">inputDate</span> <span class="o">=</span> <span class="nx">DateTime</span><span class="p">.</span><span class="nx">fromFormat</span><span class="p">(</span><span class="nx">params</span><span class="p">,</span> <span class="dl">'</span><span class="s1">yyyy-M-dd</span><span class="dl">'</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">inputDate</span><span class="p">);</span>
    <span class="c1">// Add the date: NB this should be in a model somewhere</span>
    <span class="nx">sql</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">INSERT into dates (date) VALUES (?)</span><span class="dl">"</span><span class="p">;</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="k">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">sql</span><span class="p">,</span> <span class="p">[</span><span class="nx">inputDate</span><span class="p">.</span><span class="nx">toSQLDate</span><span class="p">()]);</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">`Error while adding date `</span><span class="p">,</span> <span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="dl">'</span><span class="s1">sorry there was an error</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="dl">'</span><span class="s1">date added</span><span class="dl">'</span><span class="p">);</span>
<span class="p">});</span>

</code></pre></div></div>

<p>Useful references on jQuery datepicker</p>

<p>https://www.codexworld.com/add-date-time-picker-input-field-jquery/</p>

<p>https://www.codexworld.com/add-datepicker-to-input-field-jquery-ui/</p>

<p>Luxon and timezones:
https://www.thisdot.co/blog/how-to-handle-time-zones-using-datetime-and-luxon
https://timetc.medium.com/working-with-dates-some-things-i-learned-so-far-43b9e0c8df75</p>


      
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.0/anchor.min.js" integrity="sha256-lZaRhKri35AyJSypXXs4o6OPFTbTmUoltBbDCbdzegg=" crossorigin="anonymous"></script>
    <script>anchors.add();</script>
  </body>
</html>
